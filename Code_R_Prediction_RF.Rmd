---
title: "foret aléatoire"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(kableExtra)
library(readxl)
```

# Charger les données (JAR_intendite_gout)

```{r}
conso_bdb_freq=as.data.frame(read_excel("J:/analsens_R01/Stagiaire/Julie 2021-2022/Aromatheque/Données Aromathèque\\conso_freq_bdb_Jar3.xlsx"))
rownames(conso_bdb_freq)=conso_bdb_freq$Produit
conso_bdb_freq=conso_bdb_freq[order(conso_bdb_freq$Produit),]
conso_all_bdb=conso_bdb_freq[,-1]
rm(conso_bdb_freq)
path_data <- "J:/analsens_R01/Stagiaire/Julie 2021-2022/Aromatheque/memoire/"
load(paste(path_data,"moyenne_ajuste_BDB_all.RData",sep=""))

moyenne_ajuste_bdb_all$Produit=row.names(moyenne_ajuste_bdb_all)
rownames(moyenne_ajuste_bdb_all)=moyenne_ajuste_bdb_all$Produit
moyenne_ajuste_bdb_all=moyenne_ajuste_bdb_all[order(moyenne_ajuste_bdb_all$Produit),]
moyenne_ajuste_bdb_all=moyenne_ajuste_bdb_all[,-39]

groupe=as.data.frame(conso_all_bdb[,c(13,14,15,16)])
sensogroupe=as.data.frame(cbind(moyenne_ajuste_bdb_all,groupe))
```

# Création des tableaux de données par sélection de variables à la main

On enleve les variables dont les résidus ne suivent pas une loi normale centrée réduite (pour les moyennes ajustées)
```{r}
sensogroupe2=sensogroupe[,-c(2,3,4,6,7,8,9,28,29,32,34,35)]
```

On enlève les variables vraiment très fortement corrélé entre elles (>0.85) et les variables dont les résidus ne suivent pas une loi normale centrée réduite (pour les moyennes ajustées)
```{r}
sensogroupe3=sensogroupe2[,-c(10,12,15,20,14,22,23)]
```

on enlève seulement les variables vraiment très fortement corrélé entre elles (>0.85)

```{r}
sensogroupe4=sensogroupe[,-c(17,19,21,22,27,31,33)]
```

# Réécriture de certaines variables

```{r}
names(sensogroupe)[names(sensogroupe)=="HALEINE SAINE5"] <- "HALEINE_SAINE5"
names(sensogroupe)[names(sensogroupe)=="HALEINE SAINE4"] <- "HALEINE_SAINE4"
names(sensogroupe)[names(sensogroupe)=="BOUCHE PATEUSE5"] <- "BOUCHE_PATEUSE5"

names(sensogroupe2)[names(sensogroupe2)=="HALEINE SAINE5"] <- "HALEINE_SAINE5"
names(sensogroupe2)[names(sensogroupe2)=="HALEINE SAINE4"] <- "HALEINE_SAINE4"
names(sensogroupe2)[names(sensogroupe2)=="BOUCHE PATEUSE5"] <- "BOUCHE_PATEUSE5"

names(sensogroupe3)[names(sensogroupe3)=="HALEINE SAINE5"] <- "HALEINE_SAINE5"
names(sensogroupe3)[names(sensogroupe3)=="HALEINE SAINE4"] <- "HALEINE_SAINE4"
names(sensogroupe3)[names(sensogroupe3)=="BOUCHE PATEUSE5"] <- "BOUCHE_PATEUSE5"

names(sensogroupe4)[names(sensogroupe4)=="HALEINE SAINE5"] <- "HALEINE_SAINE5"
names(sensogroupe4)[names(sensogroupe4)=="HALEINE SAINE4"] <- "HALEINE_SAINE4"
names(sensogroupe4)[names(sensogroupe4)=="BOUCHE PATEUSE5"] <- "BOUCHE_PATEUSE5"
```
# Mise des jours des variables en facteurs ordinals
```{r}
sensogroupe$class_jar_gout_2=factor(sensogroupe$class_jar_gout_2, ordered = TRUE)
sensogroupe$class_jar_gout_3=factor(sensogroupe$class_jar_gout_3, ordered = TRUE)
sensogroupe$class_jar_gout_4=factor(sensogroupe$class_jar_gout_4, ordered = TRUE)

sensogroupe2$class_jar_gout_2=factor(sensogroupe2$class_jar_gout_2, ordered = TRUE)
sensogroupe2$class_jar_gout_3=factor(sensogroupe2$class_jar_gout_3, ordered = TRUE)
sensogroupe2$class_jar_gout_4=factor(sensogroupe2$class_jar_gout_4, ordered = TRUE)

sensogroupe3$class_jar_gout_2=factor(sensogroupe3$class_jar_gout_2, ordered = TRUE)
sensogroupe3$class_jar_gout_3=factor(sensogroupe3$class_jar_gout_3, ordered = TRUE)
sensogroupe3$class_jar_gout_4=factor(sensogroupe3$class_jar_gout_4, ordered = TRUE)

sensogroupe4$class_jar_gout_2=factor(sensogroupe4$class_jar_gout_2, ordered = TRUE)
sensogroupe4$class_jar_gout_3=factor(sensogroupe4$class_jar_gout_3, ordered = TRUE)
sensogroupe4$class_jar_gout_4=factor(sensogroupe4$class_jar_gout_4, ordered = TRUE)
```

# Recherche des valeurs manquantes
```{r}
which(is.na(sensogroupe),arr.ind=TRUE)
```

# Analyse de la taille des classes

```{r}
table(sensogroupe$class_jar_gout_2)
barplot(table(sensogroupe$class_jar_gout_2),
 col = c("blue", "pink","green","purple"), ylab="effectif")
```

```{r}
table(sensogroupe$class_jar_gout_3)
barplot(table(sensogroupe$class_jar_gout_3),
 col = c("blue", "pink","green","purple"), ylab="effectif")
```

```{r}
table(sensogroupe$class_jar_gout_4)
barplot(table(sensogroupe$class_jar_gout_4),
 col = c("blue", "pink","green","purple"),ylab="effectif")
```

Pour gérer et prendre en compte le déséquilibre de classe, nous allons utiliser la métrique Score_F1,
qui est une des mesure courante pour evaluer le succès d'un classifieur. 

## Pédiction par validation croisée k-fold et Monte Carlo

# groupe 1
```{r warning=FALSE}
F1_complet=function(x,data){
  set.seed(123)
  F1=foreach(i=1:x,.combine=cbind)%dopar%{
          ind=sample(2,nrow(data), replace=TRUE, prob = c(0.8,0.2))
          train= data[ind==1,]
          test=data[ind==2,]

          train.control=caret::trainControl(method="CV",number=10)
          
          modelcomp <- caret::train(class_jar_gout_2~., data = train[,-c(41,39,42)],method="rf", ntree= 500,trControl=train.control)
  
          pred=predict(modelcomp, test[,-c(42,41,40,39)])
          #F1_macro_complet2[i]=ScoreF1_macro(test$class_jar_gout_2, pred, 2)
          
          F1_score_complet=caret::confusionMatrix(pred,test$class_jar_gout_2, mode =
                                                "everything",positive="1")$byClass[7]
          
          precison=caret::confusionMatrix(pred,test$class_jar_gout_2, mode =
                                                "everything",positive="1")$byClass[5]
          recall=caret::confusionMatrix(pred,test$class_jar_gout_2, mode =
                                                "everything",positive="1")$byClass[6]
          perf=list(F1=F1_score_complet)
          
  }

  moy_F1_score_complet=mean(F1[!is.na(F1)])
  moy_precision=mean(F1[!is.na(F1)])
  
  return(list(moy_F1_complet=as.numeric(moy_F1_score_complet),F1_complet=as.numeric(F1)))
}


start.time <- Sys.time()
func_F1_complet=F1_complet(1000,sensogroupe)
end.time <- Sys.time()

# Time taken by estimation :
print(end.time - start.time)
```
```{r}
func_F1_complet$F1_complet
```

```{r warning=FALSE}

F1_normalite=function(x,data){
  set.seed(123)
  F1=foreach(i=1:x,.combine=cbind)%dopar%{
        ind2=sample(2,nrow(data), replace=TRUE, prob = c(0.8,0.2))
        train2= data[ind2==1,]
        test2=data[ind2==2,]
        
        train.control=caret::trainControl(method="CV",number=10)
        
        modelnormalite <- caret::train(class_jar_gout_2~., data = train2[,-c(30,29,27)],method="rf", ntree = 500,trControl=train.control)

        pred2=predict(modelnormalite, test2[,-c(30,29,28,27)])
        #F1_macro_normalite2[i]=ScoreF1_macro(test2$class_jar_gout_2, pred2, 2)
        F1_score_normalite=caret::confusionMatrix(pred2,test2$class_jar_gout_2, mode = "everything")$byClass[7]

  }
  
    
  moy_F1_score_normalite=mean(F1[!is.na(F1)])
  
  return(list(moy_F1_normalite=as.numeric(moy_F1_score_normalite),F1_normalite=as.numeric(F1)))
}

start.time <- Sys.time()
func_F1_normalite=F1_normalite(1000,sensogroupe2)
end.time <- Sys.time()

print(end.time - start.time)
```
```{r}
summary(func_F1_normalite$F1_normalite)
```

```{r warning=FALSE}
F1_normcorr=function(x,data){
  set.seed(123)
  F1=foreach(i=1:x,.combine=cbind)%dopar%{
        ind3=sample(2,nrow(data), replace=TRUE, prob = c(0.8,0.2))
        train3= data[ind3==1,]
        test3=data[ind3==2,]
        
        train.control=caret::trainControl(method="CV",number=10)
        
        modelnormcorr <- caret::train(class_jar_gout_2~., data = train3[,-c(23,22,20)],method="rf", ntree = 500,trControl=train.control)

        pred2=predict(modelnormcorr, test3[,-c(23,22,21,20)])
        #F1_macro_normcorr[i]=ScoreF1_macro(test2$class_jar_gout_2, pred2, 2)
        F1_score_normcorr=caret::confusionMatrix(pred2,test3$class_jar_gout_2, mode = "everything")$byClass[7]
        
  }

  moy_F1_score_normcorr=mean(F1[!is.na(F1)])
  
  return(list(moy_F1_normcorr=as.numeric(moy_F1_score_normcorr),F1_normcorr=as.numeric(F1)))
}


start.time <- Sys.time()
func_F1_normcorr=F1_normcorr(1000,sensogroupe3)
print(end.time - start.time)
```

```{r warning=FALSE}
F1_corr=function(x,data){
  set.seed(123)
  F1=foreach(i=1:x,.combine=cbind)%dopar%{
        ind2=sample(2,nrow(data), replace=TRUE, prob = c(0.8,0.2))
        train2= data[ind2==1,]
        test2=data[ind2==2,]
        
        train.control=caret::trainControl(method="CV",number=10)
        
        modelcorr <- caret::train(class_jar_gout_2~., data = train2[,-c(35,34,32)],method="rf", ntree = 500,trControl=train.control)

        pred2=predict(modelcorr, test2[,-c(35,34,33,32)])
        #F1_macro_corr[i]=ScoreF1_macro(test2$class_jar_gout_2, pred2, 2)
        F1_score_corr=caret::confusionMatrix(pred2,test2$class_jar_gout_2, mode = "everything")$byClass[7]
        
  }
  
  moy_F1_score_corr=mean(F1[!is.na(F1)])
  
  return(list(moy_F1_corr=as.numeric(moy_F1_score_corr),F1_corr=as.numeric(F1)))
}


start.time <- Sys.time()
func_F1_corr=F1_corr(1000,sensogroupe4)
end.time <- Sys.time()

print(end.time-start.time)
```

# groupe 2

```{r warning=FALSE}

library(doParallel)
F1_comp_groupe3=function(x,data){
  set.seed(123)
  F1_comp=foreach(i=1:x,.combine=cbind,.packages=c("caret"))%dopar%{
        ind=sample(2,nrow(data), replace=TRUE, prob = c(0.8,0.2))
        train= data[ind==1,]
        test=data[ind==2,]
        
        train.control=caret::trainControl(method="CV",number=10)
        
        modelcomp2 <- caret::train(class_jar_gout_3~., data = train[,-c(42,40,39)],method="rf", ntree = 500,trControl=train.control)


        pred=predict(modelcomp2, test[,-c(42,41,40,39)])
        F1_class1=as.data.frame(caret::confusionMatrix(pred, test$class_jar_gout_3,  mode = "everything")$byClass)$F1[1]
        F1_class2=as.data.frame(caret::confusionMatrix(pred, test$class_jar_gout_3,  mode = "everything")$byClass)$F1[2]
        F1_class3=as.data.frame(caret::confusionMatrix(pred, test$class_jar_gout_3,  mode = "everything")$byClass)$F1[3]
        
        preci_class1=as.data.frame(caret::confusionMatrix(pred, test$class_jar_gout_3,  mode = "everything")$byClass)$Precision[1]
        preci_class2=as.data.frame(caret::confusionMatrix(pred, test$class_jar_gout_3,  mode = "everything")$byClass)$Precision[2]
        preci_class3=as.data.frame(caret::confusionMatrix(pred, test$class_jar_gout_3,  mode = "everything")$byClass)$Precision[3]
        
        recall_class1=as.data.frame(caret::confusionMatrix(pred, test$class_jar_gout_3,  mode = "everything")$byClass)$Recall[1]
        recall_class2=as.data.frame(caret::confusionMatrix(pred, test$class_jar_gout_3,  mode = "everything")$byClass)$Recall[2]
        recall_class3=as.data.frame(caret::confusionMatrix(pred, test$class_jar_gout_3,  mode = "everything")$byClass)$Recall[3]
        
        F1_class1[F1_class1=="NaN"]=0
        F1_class2[F1_class2=="NaN"]=0
        F1_class3[F1_class3=="NaN"]=0
        
        preci_class1[preci_class1=="NaN"]=0
        preci_class2[preci_class2=="NaN"]=0
        preci_class3[preci_class3=="NaN"]=0
        
        recall_class1[recall_class1=="NaN"]=0
        recall_class2[recall_class2=="NaN"]=0
        recall_class3[recall_class3=="NaN"]=0
        
        F1_class=c(F1_class1,F1_class2,F1_class3)
        preci_class=c(preci_class1,preci_class2,preci_class3)
        recall_class=c(recall_class1,recall_class2,recall_class3)
        
        F1_macro=mean(F1_class[!is.na(F1_class)])
        precision=mean(preci_class[!is.na(preci_class)])
        recall=mean(recall_class[!is.na(recall_class)])
        
        
        perf=t(data.frame(F1=F1_macro,precision=precision,recall=recall,F1_class1=F1_class1,F1_class2=F1_class2,F1_class3=F1_class3,preci_class1=preci_class1,preci_class2=preci_class2,preci_class3=preci_class3,recall_class1=recall_class1,recall_class2=recall_class2,recall_class3=recall_class3))

  }
  moy=rowMeans(F1_comp)
  return(list(moy=moy[1:3],tab=data.frame(F1_comp)))
  }
F1_norm_groupe3=function(x,data){
  set.seed(123)
  
   F1_norm=foreach(i=1:x,.combine=cbind,.packages=c("caret"))%dopar%{
    
        ind2=sample(2,nrow(data), replace=TRUE, prob = c(0.8,0.2))
        train2= data[ind2==1,]
        test2=data[ind2==2,]
        
        
        train.control=caret::trainControl(method="CV",number=10)
        
        modelnormalite2 <- caret::train(class_jar_gout_3~., data = train2[,-c(30,28,27)],method="rf", ntree = 500,trControl=train.control)

         

        pred2=predict(modelnormalite2, test2[,-c(30,29,28,27)])
        #CM2=caret::confusionMatrix(pred2,test2$class_jar_gout_3, mode = "everything")
        F1_class1=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_3, mode = "everything")$byClass)$F1[1]
        F1_class2=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_3, mode = "everything")$byClass)$F1[2]
        F1_class3=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_3, mode = "everything")$byClass)$F1[3]
        
        preci_class1=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_3, mode = "everything")$byClass)$Precision[1]
        preci_class2=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_3, mode = "everything")$byClass)$Precision[2]
        preci_class3=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_3, mode = "everything")$byClass)$Precision[3]
        
        recall_class1=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_3, mode = "everything")$byClass)$Recall[1]
        recall_class2=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_3, mode = "everything")$byClass)$Recall[2]
        recall_class3=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_3, mode = "everything")$byClass)$Recall[3]
        
        F1_class1[F1_class1=="NaN"]=0
        F1_class2[F1_class2=="NaN"]=0
        F1_class3[F1_class3=="NaN"]=0
        
        preci_class1[preci_class1=="NaN"]=0
        preci_class2[preci_class2=="NaN"]=0
        preci_class3[preci_class3=="NaN"]=0
        
        recall_class1[recall_class1=="NaN"]=0
        recall_class2[recall_class2=="NaN"]=0
        recall_class3[recall_class3=="NaN"]=0
        
        F1_class=c(F1_class1,F1_class2,F1_class3)
        preci_class=c(preci_class1,preci_class2,preci_class3)
        recall_class=c(recall_class1,recall_class2,recall_class3)
        
        F1_macro=mean(F1_class[!is.na(F1_class)])
        precision=mean(preci_class[!is.na(preci_class)])
        recall=mean(recall_class[!is.na(recall_class)])
        
        
        perf=t(data.frame(F1=F1_macro,precision=precision,recall=recall,F1_class1=F1_class1,F1_class2=F1_class2,F1_class3=F1_class3,preci_class1=preci_class1,preci_class2=preci_class2,preci_class3=preci_class3,recall_class1=recall_class1,recall_class2=recall_class2,recall_class3=recall_class3))

   }
   moy=rowMeans(F1_norm)
  return(list(moy=moy[1:3],tab=data.frame(F1_norm)))
   }
F1_normcorr_groupe3=function(x,data){
  set.seed(123)
    F1_normcorr=foreach(i=1:x,.combine=cbind,.packages=c("caret"))%dopar%{
    
        ind3=sample(2,nrow(data), replace=TRUE, prob = c(0.8,0.2))
        train3= data[ind3==1,]
        test3=data[ind3==2,]
        
        
        train.control=caret::trainControl(method="CV",number=10)
        
        modelnormcorr2 <-caret::train(class_jar_gout_3~., data = train3[,-c(23,21,20)],method="rf", ntree = 500,trControl=train.control)
        
        
        pred3=predict(modelnormcorr2, test3[,-c(23,22,21,20)])
        F1_class1=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3,  mode = "everything")$byClass)$F1[1]
        F1_class2=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3,  mode = "everything")$byClass)$F1[2]
        F1_class3=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3,  mode = "everything")$byClass)$F1[3]
        
        preci_class1=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3,  mode = "everything")$byClass)$Precision[1]
        preci_class2=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3, mode = "everything")$byClass)$Precision[2]
        preci_class3=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3, mode = "everything")$byClass)$Precision[3]
        
        recall_class1=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3, mode = "everything")$byClass)$Recall[1]
        recall_class2=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3, mode = "everything")$byClass)$Recall[2]
        recall_class3=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3, mode = "everything")$byClass)$Recall[3]
        
        F1_class1[F1_class1=="NaN"]=0
        F1_class2[F1_class2=="NaN"]=0
        F1_class3[F1_class3=="NaN"]=0
        
        preci_class1[preci_class1=="NaN"]=0
        preci_class2[preci_class2=="NaN"]=0
        preci_class3[preci_class3=="NaN"]=0
        
        recall_class1[recall_class1=="NaN"]=0
        recall_class2[recall_class2=="NaN"]=0
        recall_class3[recall_class3=="NaN"]=0
        
        F1_class=c(F1_class1,F1_class2,F1_class3)
        preci_class=c(preci_class1,preci_class2,preci_class3)
        recall_class=c(recall_class1,recall_class2,recall_class3)
        
        F1_macro=mean(F1_class[!is.na(F1_class)])
        precision=mean(preci_class[!is.na(preci_class)])
        recall=mean(recall_class[!is.na(recall_class)])
        
        
        perf=t(data.frame(F1=F1_macro,precision=precision,recall=recall,F1_class1=F1_class1,F1_class2=F1_class2,F1_class3=F1_class3,preci_class1=preci_class1,preci_class2=preci_class2,preci_class3=preci_class3,recall_class1=recall_class1,recall_class2=recall_class2,recall_class3=recall_class3))
    }
  moy=rowMeans(F1_normcorr)
  return(list(moy=moy[1:3],tab=data.frame(F1_normcorr)))
}  
F1_corr_groupe3=function(x,data){
     set.seed(123)
     F1_corr=foreach(i=1:x,.combine=cbind,.packages=c("caret"))%dopar%{
     
        ind4=sample(2,nrow(data), replace=TRUE, prob = c(0.8,0.2))
        train4= data[ind4==1,]
        test4=data[ind4==2,]
        
        
        train.control=caret::trainControl(method="CV",number=10)
        
        
        modelcorr2 <-caret::train(class_jar_gout_3~., data = train4[,-c(35,33,32)],method="rf", ntree = 500,trControl=train.control)


        pred4=predict(modelcorr2, test4[,-c(35,34,33,32)])
        F1_class1=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_3, mode = "everything")$byClass)$F1[1]
        F1_class2=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_3, mode = "everything")$byClass)$F1[2]
        F1_class3=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_3, mode = "everything")$byClass)$F1[3]
        
        preci_class1=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_3, mode = "everything")$byClass)$Precision[1]
        preci_class2=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_3, mode = "everything")$byClass)$Precision[2]
        preci_class3=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_3, mode = "everything")$byClass)$Precision[3]
        
        recall_class1=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_3, mode = "everything")$byClass)$Recall[1]
        recall_class2=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_3, mode = "everything")$byClass)$Recall[2]
        recall_class3=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_3, mode = "everything")$byClass)$Recall[3]
        
        F1_class1[F1_class1=="NaN"]=0
        F1_class2[F1_class2=="NaN"]=0
        F1_class3[F1_class3=="NaN"]=0
        
        preci_class1[preci_class1=="NaN"]=0
        preci_class2[preci_class2=="NaN"]=0
        preci_class3[preci_class3=="NaN"]=0
        
        recall_class1[recall_class1=="NaN"]=0
        recall_class2[recall_class2=="NaN"]=0
        recall_class3[recall_class3=="NaN"]=0
        
        F1_class=c(F1_class1,F1_class2,F1_class3)
        preci_class=c(preci_class1,preci_class2,preci_class3)
        recall_class=c(recall_class1,recall_class2,recall_class3)
        
        F1_macro=mean(F1_class[!is.na(F1_class)])
        precision=mean(preci_class[!is.na(preci_class)])
        recall=mean(recall_class[!is.na(recall_class)])
        
        
        perf=t(data.frame(F1=F1_macro,precision=precision,recall=recall,F1_class1=F1_class1,F1_class2=F1_class2,F1_class3=F1_class3,preci_class1=preci_class1,preci_class2=preci_class2,preci_class3=preci_class3,recall_class1=recall_class1,recall_class2=recall_class2,recall_class3=recall_class3))
     }

  moy=rowMeans(F1_corr)
  return(list(moy=moy[1:3],tab=data.frame(F1_corr)))
}




start.time <- Sys.time()
func_F1_comp_groupe3=F1_comp_groupe3(1000,sensogroupe)
func_F1_norm_groupe3=F1_norm_groupe3(1000,sensogroupe2)
func_F1_normcorr_groupe3=F1_normcorr_groupe3(1000,sensogroupe3)
func_F1_corr_groupe3=F1_corr_groupe3(1000,sensogroupe4)
end.time <- Sys.time()

print(end.time-start.time)
```


# groupe 3
```{r warning=FALSE}

library(doParallel)
F1_comp_groupe4=function(x,data){
  set.seed(123)
  F1_comp=foreach(i=1:x,.combine=cbind,.packages=c("caret"))%dopar%{
        ind=sample(2,nrow(data), replace=TRUE, prob = c(0.8,0.2))
        train= data[ind==1,]
        test=data[ind==2,]
        
        train.control=caret::trainControl(method="CV",number=10)
        
        modelcomp3 <- caret::train(class_jar_gout_4~., data = train[,-c(40,39,41)],method="rf", ntree = 500,trControl=train.control)


        pred=predict(modelcomp3, test[,-c(42,41,40,39)])
        F1_class1=as.data.frame(caret::confusionMatrix(pred,test$class_jar_gout_4, mode = "everything")$byClass)$F1[1]
        F1_class2=as.data.frame(caret::confusionMatrix(pred,test$class_jar_gout_4, mode = "everything")$byClass)$F1[2]
        F1_class3=as.data.frame(caret::confusionMatrix(pred,test$class_jar_gout_4, mode = "everything")$byClass)$F1[3]
        
        preci_class1=as.data.frame(caret::confusionMatrix(pred,test$class_jar_gout_4, mode = "everything")$byClass)$Precision[1]
        preci_class2=as.data.frame(caret::confusionMatrix(pred,test$class_jar_gout_4, mode = "everything")$byClass)$Precision[2]
        preci_class3=as.data.frame(caret::confusionMatrix(pred,test$class_jar_gout_4, mode = "everything")$byClass)$Precision[3]
        
        recall_class1=as.data.frame(caret::confusionMatrix(pred,test$class_jar_gout_4, mode = "everything")$byClass)$Recall[1]
        recall_class2=as.data.frame(caret::confusionMatrix(pred,test$class_jar_gout_4, mode = "everything")$byClass)$Recall[2]
        recall_class3=as.data.frame(caret::confusionMatrix(pred,test$class_jar_gout_4, mode = "everything")$byClass)$Recall[3]
        
        F1_class1[F1_class1=="NaN"]=0
        F1_class2[F1_class2=="NaN"]=0
        F1_class3[F1_class3=="NaN"]=0
        
        preci_class1[preci_class1=="NaN"]=0
        preci_class2[preci_class2=="NaN"]=0
        preci_class3[preci_class3=="NaN"]=0
        
        recall_class1[recall_class1=="NaN"]=0
        recall_class2[recall_class2=="NaN"]=0
        recall_class3[recall_class3=="NaN"]=0
        
        F1_class=c(F1_class1,F1_class2,F1_class3)
        preci_class=c(preci_class1,preci_class2,preci_class3)
        recall_class=c(recall_class1,recall_class2,recall_class3)
        
        F1_macro=mean(F1_class[!is.na(F1_class)])
        precision=mean(preci_class[!is.na(preci_class)])
        recall=mean(recall_class[!is.na(recall_class)])
        
        
        perf=t(data.frame(F1=F1_macro,precision=precision,recall=recall,F1_class1=F1_class1,F1_class2=F1_class2,F1_class3=F1_class3,preci_class1=preci_class1,preci_class2=preci_class2,preci_class3=preci_class3,recall_class1=recall_class1,recall_class2=recall_class2,recall_class3=recall_class3))

  }
  moy=rowMeans(F1_comp)
  return(list(moy=moy[1:3],tab=data.frame(F1_comp)))
  }
F1_norm_groupe4=function(x,data){
  set.seed(123)
  
   F1_norm=foreach(i=1:x,.combine=cbind,.packages=c("caret"))%dopar%{
    
        ind2=sample(2,nrow(data), replace=TRUE, prob = c(0.8,0.2))
        train2= data[ind2==1,]
        test2=data[ind2==2,]
        
        
        train.control=caret::trainControl(method="CV",number=10)
        
        modelnormalite3 <- caret::train(class_jar_gout_4~., data = train2[,-c(29,28,27)],method="rf", ntree = 500,trControl=train.control)

         

      
        pred2=predict(modelnormalite3, test2[,-c(30,29,28,27)])
        #CM2=caret::confusionMatrix(test2$class_jar_gout_3, pred2, mode = "everything")
        F1_class1=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_4,  mode = "everything")$byClass)$F1[1]
        F1_class2=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_4,mode = "everything")$byClass)$F1[2]
        F1_class3=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_4,mode = "everything")$byClass)$F1[3]
        
        preci_class1=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_4, mode = "everything")$byClass)$Precision[1]
        preci_class2=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_4, mode = "everything")$byClass)$Precision[2]
        preci_class3=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_4, mode = "everything")$byClass)$Precision[3]
        
        recall_class1=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_4, mode = "everything")$byClass)$Recall[1]
        recall_class2=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_4, mode = "everything")$byClass)$Recall[2]
        recall_class3=as.data.frame(caret::confusionMatrix(pred2,test2$class_jar_gout_4, mode = "everything")$byClass)$Recall[3]
        
        F1_class1[F1_class1=="NaN"]=0
        F1_class2[F1_class2=="NaN"]=0
        F1_class3[F1_class3=="NaN"]=0
        
        preci_class1[preci_class1=="NaN"]=0
        preci_class2[preci_class2=="NaN"]=0
        preci_class3[preci_class3=="NaN"]=0
        
        recall_class1[recall_class1=="NaN"]=0
        recall_class2[recall_class2=="NaN"]=0
        recall_class3[recall_class3=="NaN"]=0
        
        F1_class=c(F1_class1,F1_class2,F1_class3)
        preci_class=c(preci_class1,preci_class2,preci_class3)
        recall_class=c(recall_class1,recall_class2,recall_class3)
        
        F1_macro=mean(F1_class[!is.na(F1_class)])
        precision=mean(preci_class[!is.na(preci_class)])
        recall=mean(recall_class[!is.na(recall_class)])
        
        
        perf=t(data.frame(F1=F1_macro,precision=precision,recall=recall,F1_class1=F1_class1,F1_class2=F1_class2,F1_class3=F1_class3,preci_class1=preci_class1,preci_class2=preci_class2,preci_class3=preci_class3,recall_class1=recall_class1,recall_class2=recall_class2,recall_class3=recall_class3))

   }
   moy=rowMeans(F1_norm)
  return(list(moy=moy[1:3],tab=data.frame(F1_norm)))
   }
F1_normcorr_groupe4=function(x,data){
  set.seed(123)
    F1_normcorr=foreach(i=1:x,.combine=cbind,.packages=c("caret"))%dopar%{
    
        ind3=sample(2,nrow(data), replace=TRUE, prob = c(0.8,0.2))
        train3= data[ind3==1,]
        test3=data[ind3==2,]
        
        
        train.control=caret::trainControl(method="CV",number=10)
        
        modelnormcorr3 <-caret::train(class_jar_gout_4~., data = train3[,-c(22,21,20)],method="rf", ntree = 500,trControl=train.control)
        
        
        
        pred3=predict(modelnormcorr3, test3[,-c(23,22,21,20)])
        F1_class1=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4,  mode = "everything")$byClass)$F1[1]
        F1_class2=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4,  mode = "everything")$byClass)$F1[2]
        F1_class3=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4,  mode = "everything")$byClass)$F1[3]
        
        preci_class1=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4,  mode = "everything")$byClass)$Precision[1]
        preci_class2=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4, mode = "everything")$byClass)$Precision[2]
        preci_class3=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4, mode = "everything")$byClass)$Precision[3]
        
        recall_class1=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4, mode = "everything")$byClass)$Recall[1]
        recall_class2=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4, mode = "everything")$byClass)$Recall[2]
        recall_class3=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4,  mode = "everything")$byClass)$Recall[3]
        
        F1_class1[F1_class1=="NaN"]=0
        F1_class2[F1_class2=="NaN"]=0
        F1_class3[F1_class3=="NaN"]=0
        
        preci_class1[preci_class1=="NaN"]=0
        preci_class2[preci_class2=="NaN"]=0
        preci_class3[preci_class3=="NaN"]=0
        
        recall_class1[recall_class1=="NaN"]=0
        recall_class2[recall_class2=="NaN"]=0
        recall_class3[recall_class3=="NaN"]=0
        
        F1_class=c(F1_class1,F1_class2,F1_class3)
        preci_class=c(preci_class1,preci_class2,preci_class3)
        recall_class=c(recall_class1,recall_class2,recall_class3)
        
        F1_macro=mean(F1_class[!is.na(F1_class)])
        precision=mean(preci_class[!is.na(preci_class)])
        recall=mean(recall_class[!is.na(recall_class)])
        
        
        perf=t(data.frame(F1=F1_macro,precision=precision,recall=recall,F1_class1=F1_class1,F1_class2=F1_class2,F1_class3=F1_class3,preci_class1=preci_class1,preci_class2=preci_class2,preci_class3=preci_class3,recall_class1=recall_class1,recall_class2=recall_class2,recall_class3=recall_class3))
    }
  moy=rowMeans(F1_normcorr)
  return(list(moy=moy[1:3],tab=data.frame(F1_normcorr)))
}  
F1_corr_groupe4=function(x,data){
     set.seed(123)
     F1_corr=foreach(i=1:x,.combine=cbind,.packages=c("caret"))%dopar%{
     
        ind4=sample(2,nrow(data), replace=TRUE, prob = c(0.8,0.2))
        train4= data[ind4==1,]
        test4=data[ind4==2,]
        
        train.control=caret::trainControl(method="CV",number=10)
        
        modelcorr3 <-caret::train(class_jar_gout_4~., data = train4[,-c(34,33,32)],method="rf", ntree = 500,trControl=train.control)


        pred4=predict(modelcorr3, test4[,-c(35,34,33,32)])
        F1_class1=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_4,  mode = "everything")$byClass)$F1[1]
        F1_class2=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_4,  mode = "everything")$byClass)$F1[2]
        F1_class3=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_4,  mode = "everything")$byClass)$F1[3]
        
        preci_class1=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_4, mode = "everything")$byClass)$Precision[1]
        preci_class2=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_4, mode = "everything")$byClass)$Precision[2]
        preci_class3=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_4, mode = "everything")$byClass)$Precision[3]
        
        recall_class1=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_4, mode = "everything")$byClass)$Recall[1]
        recall_class2=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_4, mode = "everything")$byClass)$Recall[2]
        recall_class3=as.data.frame(caret::confusionMatrix(pred4,test4$class_jar_gout_4, mode = "everything")$byClass)$Recall[3]
        
        F1_class1[F1_class1=="NaN"]=0
        F1_class2[F1_class2=="NaN"]=0
        F1_class3[F1_class3=="NaN"]=0
        
        preci_class1[preci_class1=="NaN"]=0
        preci_class2[preci_class2=="NaN"]=0
        preci_class3[preci_class3=="NaN"]=0
        
        recall_class1[recall_class1=="NaN"]=0
        recall_class2[recall_class2=="NaN"]=0
        recall_class3[recall_class3=="NaN"]=0
        
        F1_class=c(F1_class1,F1_class2,F1_class3)
        preci_class=c(preci_class1,preci_class2,preci_class3)
        recall_class=c(recall_class1,recall_class2,recall_class3)
        
        F1_macro=mean(F1_class[!is.na(F1_class)])
        precision=mean(preci_class[!is.na(preci_class)])
        recall=mean(recall_class[!is.na(recall_class)])
        
        
        perf=t(data.frame(F1=F1_macro,precision=precision,recall=recall,F1_class1=F1_class1,F1_class2=F1_class2,F1_class3=F1_class3,preci_class1=preci_class1,preci_class2=preci_class2,preci_class3=preci_class3,recall_class1=recall_class1,recall_class2=recall_class2,recall_class3=recall_class3))
     }

  moy=rowMeans(F1_corr)
  return(list(moy=moy[1:3],tab=data.frame(F1_corr)))
}




start.time <- Sys.time()
func_F1_comp_groupe4=F1_comp_groupe4(1000,sensogroupe)
func_F1_norm_groupe4=F1_norm_groupe4(1000,sensogroupe2)
func_F1_normcorr_groupe4=F1_normcorr_groupe4(1000,sensogroupe3)
func_F1_corr_groupe4=F1_corr_groupe4(1000,sensogroupe4)
end.time <- Sys.time()

print(end.time-start.time)
```

# Tableau des performances
```{r}
#NNS=non normalité supp
#CS=corrélation supp
groupe_mod=c(rep(1,4),rep(2,4),rep(3,4))
moy_F1_groupe1=c(func_F1_complet$moy_F1_complet,func_F1_normalite$moy_F1_normalite,func_F1_normcorr$moy_F1_normcorr,func_F1_corr$moy_F1_corr)
moy_F1_groupe2=c(func_F1_comp_groupe3$moy[1],func_F1_norm_groupe3$moy[1],func_F1_normcorr_groupe3$moy[1],func_F1_corr_groupe3$moy[1])
moy_F1_groupe3=c(func_F1_comp_groupe4$moy[1],func_F1_norm_groupe4$moy[1],func_F1_normcorr_groupe4$moy[1],func_F1_corr_groupe4$moy[1])

moy_F1=data.frame(moy_F1_groupe1,moy_F1_groupe2,moy_F1_groupe3)
rownames(moy_F1)=c("complet","NNS","NNS+CS","CS")
moy_F1

```
# Optimisation des modèles retenus par l'impurté de GINI.
# Modèle 1
```{r}
modelnormalite <- caret::train(class_jar_gout_2~., data = sensogroupe2[,-c(30,29,27)],method="rf", ntree = 500)
V=varImp(modelnormalite)
ggplot2::ggplot(V) 
```

```{r}
data_normaliteGINI=data.frame(sensogroupe2[,c("HALEINE_SAINE4","HALEINE_SAINE5","FRAIS4","AROME4","FRAIS5","AROME5","ODEUR1","class_jar_gout_2")])
```

```{r warning=FALSE}

F1_normaliteGINI=function(x,data){
  set.seed(123)
  F1=foreach(i=1:x,.combine=cbind)%dopar%{
        ind2=sample(2,nrow(data), replace=TRUE, prob = c(0.8,0.2))
        train2= data[ind2==1,]
        test2=data[ind2==2,]
        
        train.control=caret::trainControl(method="CV",number=10)
        
        modelnormalite <- caret::train(class_jar_gout_2~., data = train2,method="rf", ntree = 500,trControl=train.control)

        pred2=predict(modelnormalite, test2[,-c(8)])
        #F1_macro_normalite2[i]=ScoreF1_macro(test2$class_jar_gout_2, pred2, 2)
        F1_score_normalite=caret::confusionMatrix(pred2,test2$class_jar_gout_2, mode = "everything")$byClass[7]

  }
  
    
  moy_F1_score_normalite=mean(F1[!is.na(F1)])
  
  return(list(moy_F1_normalite=as.numeric(moy_F1_score_normalite),F1_normalite=as.numeric(F1)))
}

start.time <- Sys.time()
func_F1_normalite_GINI=F1_normaliteGINI(1000,data_normaliteGINI)
# Estimation ends...
end.time <- Sys.time()

# Time taken by estimation :
print(end.time - start.time)
```
```{r}
summary(func_F1_normalite$F1_normalite)
```

# Modèle 2
```{r}
modelnormcorr2 <-caret::train(class_jar_gout_3~., data = sensogroupe3[,-c(23,21,20)],method="rf", ntree = 500)
V2=varImp(modelnormcorr2)
ggplot2::ggplot(V2) 
```

```{r}
data_normcorrGINI=data.frame(sensogroupe2[,c("HALEINE_SAINE5","AROME4","AROME5","ODEUR1","ASTRINGENT4","VISCOSITE2","class_jar_gout_3")])
```

```{r warning=FALSE}

library(doParallel)
F1_normcorr_groupe3GINI=function(x,data){
  set.seed(123)
    F1_normcorr=foreach(i=1:x,.combine=cbind,.packages=c("caret"))%dopar%{
    
        ind3=sample(2,nrow(data), replace=TRUE, prob = c(0.8,0.2))
        train3= data[ind3==1,]
        test3=data[ind3==2,]
        
        
        train.control=caret::trainControl(method="CV",number=10)
        
        modelnormcorr2 <-caret::train(class_jar_gout_3~., data = train3,method="rf", ntree = 500,trControl=train.control)
        
        
        pred3=predict(modelnormcorr2, test3[,-c(7)])
        F1_class1=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3,  mode = "everything")$byClass)$F1[1]
        F1_class2=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3,  mode = "everything")$byClass)$F1[2]
        F1_class3=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3,  mode = "everything")$byClass)$F1[3]
        
        preci_class1=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3,  mode = "everything")$byClass)$Precision[1]
        preci_class2=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3, mode = "everything")$byClass)$Precision[2]
        preci_class3=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3, mode = "everything")$byClass)$Precision[3]
        
        recall_class1=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3, mode = "everything")$byClass)$Recall[1]
        recall_class2=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3, mode = "everything")$byClass)$Recall[2]
        recall_class3=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_3, mode = "everything")$byClass)$Recall[3]
        
        F1_class1[F1_class1=="NaN"]=0
        F1_class2[F1_class2=="NaN"]=0
        F1_class3[F1_class3=="NaN"]=0
        
        preci_class1[preci_class1=="NaN"]=0
        preci_class2[preci_class2=="NaN"]=0
        preci_class3[preci_class3=="NaN"]=0
        
        recall_class1[recall_class1=="NaN"]=0
        recall_class2[recall_class2=="NaN"]=0
        recall_class3[recall_class3=="NaN"]=0
        
        F1_class=c(F1_class1,F1_class2,F1_class3)
        preci_class=c(preci_class1,preci_class2,preci_class3)
        recall_class=c(recall_class1,recall_class2,recall_class3)
        
        F1_macro=mean(F1_class[!is.na(F1_class)])
        precision=mean(preci_class[!is.na(preci_class)])
        recall=mean(recall_class[!is.na(recall_class)])
        
        
        perf=t(data.frame(F1=F1_macro,precision=precision,recall=recall,F1_class1=F1_class1,F1_class2=F1_class2,F1_class3=F1_class3,preci_class1=preci_class1,preci_class2=preci_class2,preci_class3=preci_class3,recall_class1=recall_class1,recall_class2=recall_class2,recall_class3=recall_class3))
    }
  moy=rowMeans(F1_normcorr)
  return(list(moy=moy[1:3],tab=data.frame(F1_normcorr)))
}  

start.time <- Sys.time()
func_F1_normcorr_groupe3GINI=F1_normcorr_groupe3GINI(1000,data_normcorrGINI)
end.time <- Sys.time()

print(end.time-start.time)
```
# Modèle 3

```{r}
modelnormcorr3 <-caret::train(class_jar_gout_4~., data = sensogroupe3[,-c(22,21,20)],method="rf", ntree = 500)
V3=varImp(modelnormcorr3)
ggplot2::ggplot(V3) 
```

```{r}
data_normcorrGINI2=data.frame(sensogroupe2[,c("HALEINE_SAINE5","AROME4","AROME5","ODEUR1","AMER3","SUCRE3","class_jar_gout_4")])
```

```{r warning=FALSE}

library(doParallel)
F1_normcorr_groupe4=function(x,data){
  set.seed(123)
    F1_normcorr=foreach(i=1:x,.combine=cbind,.packages=c("caret"))%dopar%{
    
        ind3=sample(2,nrow(data), replace=TRUE, prob = c(0.8,0.2))
        train3= data[ind3==1,]
        test3=data[ind3==2,]
        
        
        train.control=caret::trainControl(method="CV",number=10)
        
        modelnormcorr3 <-caret::train(class_jar_gout_4~., data = train3,method="rf", ntree = 500,trControl=train.control)
        
        
        
        pred3=predict(modelnormcorr3, test3[,-c(7)])
        F1_class1=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4,  mode = "everything")$byClass)$F1[1]
        F1_class2=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4,  mode = "everything")$byClass)$F1[2]
        F1_class3=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4,  mode = "everything")$byClass)$F1[3]
        
        preci_class1=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4,  mode = "everything")$byClass)$Precision[1]
        preci_class2=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4, mode = "everything")$byClass)$Precision[2]
        preci_class3=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4, mode = "everything")$byClass)$Precision[3]
        
        recall_class1=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4, mode = "everything")$byClass)$Recall[1]
        recall_class2=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4, mode = "everything")$byClass)$Recall[2]
        recall_class3=as.data.frame(caret::confusionMatrix(pred3,test3$class_jar_gout_4,  mode = "everything")$byClass)$Recall[3]
        
        F1_class1[F1_class1=="NaN"]=0
        F1_class2[F1_class2=="NaN"]=0
        F1_class3[F1_class3=="NaN"]=0
        
        preci_class1[preci_class1=="NaN"]=0
        preci_class2[preci_class2=="NaN"]=0
        preci_class3[preci_class3=="NaN"]=0
        
        recall_class1[recall_class1=="NaN"]=0
        recall_class2[recall_class2=="NaN"]=0
        recall_class3[recall_class3=="NaN"]=0
        
        F1_class=c(F1_class1,F1_class2,F1_class3)
        preci_class=c(preci_class1,preci_class2,preci_class3)
        recall_class=c(recall_class1,recall_class2,recall_class3)
        
        F1_macro=mean(F1_class[!is.na(F1_class)])
        precision=mean(preci_class[!is.na(preci_class)])
        recall=mean(recall_class[!is.na(recall_class)])
        
        
        perf=t(data.frame(F1=F1_macro,precision=precision,recall=recall,F1_class1=F1_class1,F1_class2=F1_class2,F1_class3=F1_class3,preci_class1=preci_class1,preci_class2=preci_class2,preci_class3=preci_class3,recall_class1=recall_class1,recall_class2=recall_class2,recall_class3=recall_class3))
    }
  moy=rowMeans(F1_normcorr)
  return(list(moy=moy[1:3],tab=data.frame(F1_normcorr)))
}  

start.time <- Sys.time()
func_F1_normcorr_groupe4GINI=F1_normcorr_groupe4GINI(1000,data_normcorrGINI2)

end.time <- Sys.time()

print(end.time-start.time)
```
